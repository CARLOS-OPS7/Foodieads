# Apache reverse-proxy snippet for XAMPP (Windows)
# Purpose: forward API docs endpoints served by a FastAPI/uvicorn server to Apache so
#          the portal (served by Apache on port 8080) can open /docs and /redoc.
#
# Notes:
# - This assumes uvicorn is running on localhost:8000. Adjust the backend host/port if needed.
# - Ensure the proxy modules are enabled in Apache's httpd.conf (see instructions below).
# - Place this snippet inside your Apache VirtualHost for localhost (or include it from httpd.conf).

# Enable these modules in httpd.conf (uncomment the LoadModule lines if commented):
# LoadModule proxy_module modules/mod_proxy.so
# LoadModule proxy_http_module modules/mod_proxy_http.so
# (optional but helpful)
# LoadModule proxy_balancer_module modules/mod_proxy_balancer.so
# LoadModule lbmethod_byrequests_module modules/mod_lbmethod_byrequests.so

# Example VirtualHost section (edit as appropriate, or add the ProxyPass lines to your existing
# httpd-vhosts.conf / httpd.conf). This snippet proxies only the specific docs endpoints so
# the rest of your PHP app remains served by Apache.

<VirtualHost *:8080>
    ServerName localhost
    DocumentRoot "C:/xampp/htdocs/Auth"

    # Proxy only the endpoints used by FastAPI docs
    ProxyPass "/foodieads-docs" "http://127.0.0.1:8000/foodieads-docs"
    ProxyPassReverse "/foodieads-docs" "http://127.0.0.1:8000/foodieads-docs"

    ProxyPass "/foodieads-redoc" "http://127.0.0.1:8000/foodieads-redoc"
    ProxyPassReverse "/foodieads-redoc" "http://127.0.0.1:8000/foodieads-redoc"

    ProxyPass "/openapi.json" "http://127.0.0.1:8000/openapi.json"
    ProxyPassReverse "/openapi.json" "http://127.0.0.1:8000/openapi.json"

    # If FastAPI serves any static assets for the docs under /static, proxy them too
    ProxyPass "/static/" "http://127.0.0.1:8000/static/"
    ProxyPassReverse "/static/" "http://127.0.0.1:8000/static/"

    # (Optional) oauth2 redirect used by Swagger UI (adjust if you use the custom path)
    ProxyPass "/foodieads-docs/oauth2-redirect" "http://127.0.0.1:8000/foodieads-docs/oauth2-redirect"
    ProxyPassReverse "/foodieads-docs/oauth2-redirect" "http://127.0.0.1:8000/foodieads-docs/oauth2-redirect"

    # Keep other Apache settings for your site as-is
    <Directory "C:/xampp/htdocs/Auth">
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    # Logs (optional)
    # ErrorLog "logs/foodieads-error.log"
    # CustomLog "logs/foodieads-access.log" common
</VirtualHost>

# After adding this snippet, restart Apache (via XAMPP Control Panel). If you edit httpd.conf
# remember to uncomment the LoadModule lines mentioned above.
